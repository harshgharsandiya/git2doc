# aws-cdk

The AWS Cloud Development Kit (CDK) is an open-source software development framework for defining cloud infrastructure in code and provisioning it through AWS CloudFormation. This documentation outlines key features and usage patterns within the AWS ECS module, focusing on high-level (L3) constructs and enhanced configuration capabilities.

## Key Features

The following features extend the AWS ECS module to simplify common deployment patterns and enable advanced configuration:

*   **Autoscaling Queue Processing Services:** Provides L3 constructs (`QueueProcessingEc2Service` and `QueueProcessingFargateService`) that automatically configure an ECS service, an SQS queue, and autoscaling policies. Scaling is driven by both CPU utilization and the SQS queue's `ApproximateNumberOfMessagesVisible` metric using configurable step scaling intervals.
*   **Fargate Capacity Provider Support:** Enables the use of `FARGATE` and `FARGATE_SPOT` capacity providers. Users can define capacity provider strategies on ECS Services, specifying `base` and `weight` to control task placement across different capacity types.
*   **Private Registry Authentication:** Supports pulling container images from private registries (including DockerHub and custom registries) by integrating with AWS Secrets Manager. Credentials are securely managed via the task execution role.
*   **Scheduled EC2 Tasks:** Implements a high-level construct (`ScheduledEc2Task`) to define standalone ECS tasks (EC2 launch type) that run on a recurring schedule defined by a CloudWatch Event Rule expression.
*   **AWS Cloud Map Service Discovery Integration:** Simplifies service discovery setup by allowing the creation and association of Cloud Map namespaces and services directly on ECS Clusters and Services. Supports configuration of DNS record types (A or SRV) and TTL settings.
*   **Granular Task Tagging Control:** Offers explicit control over task tagging via `propagateTaskTagsFrom` (allowing tags to be sourced from the Service or Task Definition) and `enableECSManagedTags` properties on ECS Services.

## Logic Flow and Architecture

The AWS CDK repository uses a construct-based architecture where high-level patterns (L3 constructs) build upon foundational AWS resources (L1 and L2 constructs).

### ECS Pattern Constructs

New L3 constructs abstract complex integrations:

1.  **Queue Processing Services:** These constructs internally manage the creation of an SQS Queue, an ECS Task Definition, and an ECS Service. They automatically configure the necessary IAM permissions for the task execution role to read from the queue and establish CloudWatch alarms and scaling policies to manage the desired task count based on queue backlog.
2.  **Scheduled Tasks:** The `ScheduledEc2Task` construct orchestrates an EC2 Task Definition and links it as a target to an AWS EventRule (CloudWatch Events). The EventRule uses a defined schedule expression to trigger the task execution periodically.

### Configuration Enhancements

Core ECS constructs (`Cluster`, `BaseService`, `Ec2Service`, `FargateService`) are enhanced to expose advanced configuration options:

*   **Capacity Providers:** Configuration is split between the `Cluster` (listing available providers like `FARGATE_SPOT`) and the `Service` (defining the strategy, including base and weight, for task placement).
*   **Service Discovery:** The `Cluster` provides methods to define a Cloud Map namespace. ECS Services then use `enableServiceDiscovery` to register themselves within that namespace, automatically configuring the required service registries and DNS records.
*   **Container Images:** The `ContainerImage` class is extended to handle private image sources (`fromInternet`), requiring the provision of `RepositoryCreds` backed by an AWS Secrets Manager secret, ensuring the execution role has read access to pull the image.

## Installation

As this is a framework repository, standard installation procedures apply for integrating the CDK library into a project.

```bash
# Install the AWS CDK CLI globally (if not already installed)
npm install -g aws-cdk

# Install necessary AWS CDK modules in your project
npm install @aws-cdk/aws-ecs @aws-cdk/aws-sqs @aws-cdk/aws-secretsmanager @aws-cdk/aws-servicediscovery
```

## Environment

This framework does not require specific runtime environment variables for deployment, relying instead on standard AWS credentials configured for the CDK CLI or the execution environment.